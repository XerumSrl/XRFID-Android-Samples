@page "/Skus"
@using XRFID.Sample.Server.Entities;
@using XRFID.Sample.Server.ViewModels;
@inject NavigationManager navigation;

<MudDataGrid Items="@SkuList"
             ReadOnly="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Skus</MudText>
        <MudSpacer />
        <MudButton Size="@Size.Large" Variant="@Variant.Filled" Color="@Color.Primary">New SKU</MudButton>
    </ToolBarContent>
    <Columns>
        <HierarchyColumn T="SkuModel" />
        <PropertyColumn Property="x => x.CreationTime" Title="Date Creation" />
        <PropertyColumn Property="x => x.Name" />
        <PropertyColumn Property="x => x.Code" />
        <PropertyColumn Property="x => x.Description" />
        <PropertyColumn Property="x => x.EffectivityStart" Title="Effectivity Start" />
        <PropertyColumn Property="x => x.EffectivityEnd" Title="Effectivity End" />
        <TemplateColumn CellClass="d-flex justify-end">
            <CellTemplate>
                <MudStack Row>
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" aria-label="delete" Size="Size.Medium" />
                    <MudButton Size="@Size.Small" Variant="@Variant.Filled" Color="@Color.Primary">New Product</MudButton>
                </MudStack>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
    <ChildRowContent>
        <MudCard>
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">@context.Item.Name</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudDataGrid Items="@context.Item.Products"
                             ReadOnly="true">
                    <Columns>
                        <PropertyColumn Property="x => x.Name" />
                        <PropertyColumn Property="x => x.Code" />
                        <PropertyColumn Property="x => x.Epc" />
                        <PropertyColumn Property="x => x.SerialNumber" />
                    </Columns>
                </MudDataGrid>
            </MudCardContent>
        </MudCard>
    </ChildRowContent>
    <PagerContent>
        <MudDataGridPager T="SkuModel" />
    </PagerContent>
</MudDataGrid>
@code {
    private List<SkuModel> SkuList = new List<SkuModel>();
    private List<string> _events = new();

    protected override async Task OnInitializedAsync()
    {
        //usare un viewmodel per cosa visualizzare in griglia o un dto!!! Non usare entity direttamente!
        List<SkuModel> x = new List<SkuModel>();
        for (int i = 0; i < 6; i++)
        {
            SkuModel s = new SkuModel
                {
                    Name = "sku_" + i.ToString(),
                    Description = "sku_" + i.ToString() + "_Description",
                    Products = new(),
                };

            for (int j = 0; j < 6; j++)
            {
                ProductModel p = new ProductModel
                    {
                        Name = "product_" + j.ToString(),
                        Description = "product_" + j.ToString() + "_description",
                        Epc = "product_" + j.ToString() + "_epc",
                    };
                s.Products.Add(p);
            }
            x.Add(s);
        }
        SkuList = x;
    }

    // events
    void RowClicked(DataGridRowClickEventArgs<SKU> args)
    {
        _events.Insert(0, $"Event = RowClick, Index = {args.RowIndex}, Data = {System.Text.Json.JsonSerializer.Serialize(args.Item)}");
        navigation.NavigateTo("/product");
    }


}